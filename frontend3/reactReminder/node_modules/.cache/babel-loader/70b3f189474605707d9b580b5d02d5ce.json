{"ast":null,"code":"'use strict';\n\nconst fs = require('graceful-fs');\nconst path = require('path');\nconst copy = require('../copy').copy;\nconst remove = require('../remove').remove;\nconst mkdirp = require('../mkdirs').mkdirp;\nconst pathExists = require('../path-exists').pathExists;\nconst stat = require('../util/stat');\nfunction move(src, dest, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  opts = opts || {};\n  const overwrite = opts.overwrite || opts.clobber || false;\n  stat.checkPaths(src, dest, 'move', opts, (err, stats) => {\n    if (err) return cb(err);\n    const srcStat = stats.srcStat,\n      _stats$isChangingCase = stats.isChangingCase,\n      isChangingCase = _stats$isChangingCase === void 0 ? false : _stats$isChangingCase;\n    stat.checkParentPaths(src, srcStat, dest, 'move', err => {\n      if (err) return cb(err);\n      if (isParentRoot(dest)) return doRename(src, dest, overwrite, isChangingCase, cb);\n      mkdirp(path.dirname(dest), err => {\n        if (err) return cb(err);\n        return doRename(src, dest, overwrite, isChangingCase, cb);\n      });\n    });\n  });\n}\nfunction isParentRoot(dest) {\n  const parent = path.dirname(dest);\n  const parsedPath = path.parse(parent);\n  return parsedPath.root === parent;\n}\nfunction doRename(src, dest, overwrite, isChangingCase, cb) {\n  if (isChangingCase) return rename(src, dest, overwrite, cb);\n  if (overwrite) {\n    return remove(dest, err => {\n      if (err) return cb(err);\n      return rename(src, dest, overwrite, cb);\n    });\n  }\n  pathExists(dest, (err, destExists) => {\n    if (err) return cb(err);\n    if (destExists) return cb(new Error('dest already exists.'));\n    return rename(src, dest, overwrite, cb);\n  });\n}\nfunction rename(src, dest, overwrite, cb) {\n  fs.rename(src, dest, err => {\n    if (!err) return cb();\n    if (err.code !== 'EXDEV') return cb(err);\n    return moveAcrossDevice(src, dest, overwrite, cb);\n  });\n}\nfunction moveAcrossDevice(src, dest, overwrite, cb) {\n  const opts = {\n    overwrite,\n    errorOnExist: true\n  };\n  copy(src, dest, opts, err => {\n    if (err) return cb(err);\n    return remove(src, cb);\n  });\n}\nmodule.exports = move;","map":null,"metadata":{},"sourceType":"script"}